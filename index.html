<!doctype html>
<link rel="icon" type="image/png" href="resources/favicon.png">
<link href="https://fonts.googleapis.com/css?family=Lato&display=swap" rel="stylesheet">
<meta charset="utf-8">

<style>
body {
  margin: 0;
  height: 100vh;
  font-family: 'Lato', sans-serif;
  font-size: 15px;
}
</style>

<script type=module src="./src/mm-map.mjs"></script>
<script type=module src="./src/mm-node.mjs"></script>
<script type=module src="./src/mm-context-menu.mjs"></script>
<script type=module src="./src/mm-scroller-node.mjs"></script>

<script type=module>
import { UndoStack } from "./src/undo-stack.mjs";

// TODO(vmpstr): This won't work with multiple undo stacks.
// Figure out the right spot for the undo stack.
window.gUndoStack = new UndoStack();

const promises = [
  customElements.whenDefined("mm-map"),
  customElements.whenDefined("mm-node"),
  customElements.whenDefined("mm-context-menu"),
  customElements.whenDefined("mm-scroller-node")
];

Promise.all(promises).then(() => {
  const map = document.createElement("mm-map");
  document.body.appendChild(map);
  window.addEventListener("keydown", (e) => {
    if (gUndoStack.handleKeyDown(e))
      return;
    map.handleKeyDown(e);
  });
  map.setStorage(window.localStorage);
  map.loadFromStorage();
});
</script>
